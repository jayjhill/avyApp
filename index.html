<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Avalanche Aspect App</title>
    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
.color-cell {
color: white;
}

    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.18/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.18/"></script>

    <script>
      require(["esri/Map", "esri/views/SceneView", "esri/layers/SceneLayer", "esri/layers/GeoJSONLayer"], function(Map, SceneView, SceneLayer, GeoJSONLayer) {

        avyGridTop = [];

        url = "http://mountainlabmaps.com/avy/json/SLC_GreaterThan9500.geojson";

        // Create Map
 var map = new Map({
          basemap: "topo-vector",
          ground: "world-elevation"
        });

        // Create the SceneView
        var view = new SceneView({
          container: "viewDiv",
          map: map,
          camera: {
            position: [-111.70, 40.313, 30700],
            tilt: 51,
            heading: 0
          }
        });

const task1 = ()=>{

var topArray = [
    {x: 198, y: 132},
    {x: 219, y: 138},
    {x: 233, y: 157},
    {x: 225, y: 179},
    {x: 201, y: 187},
    {x: 177, y: 176},
    {x: 163, y: 156},
    {x: 178, y: 138},
];






var img = new Image();
img.src = 'https://mountainlabmaps.com/images/avy20210303.png';
var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
img.onload = function() {
  ctx.drawImage(img, 0, 0);
  img.style.display = 'none';
    topArray.forEach(pickArray);
};

function pickArray(event) {
  var x = event.x;
  var y = event.y;

  var pixel = ctx.getImageData(x, y, 1, 1);
  var data = pixel.data;
  var r = data[0];
  var g = data[1];
  var b = data[2];

  var rgb = {r, g, b};
  console.log(rgb);
    avyGridTop.push(rgb);
};




}
const task2 = ()=>{

var rendererTop = {
          type: "unique-value", // autocasts as new UniqueValueRenderer()
          field: "gridcode",
          defaultSymbol: { type: "simple-fill" }, // autocasts as new SimpleFillSymbol()
          uniqueValueInfos: [
            {
              // All features with value of "North" will be blue
              value: "0",
              symbol: {
                type: "simple-fill", // autocasts as new SimpleFillSymbol()
                color: avyGridTop[0]
              }
            },
            {
              // All features with value of "NorthEast" will be green
              value: "1",
              symbol: {
                type: "simple-fill", // autocasts as new SimpleFillSymbol()
                color: avyGridTop[1]
              }
            },
            {
              // All features with value of "East" will be green
              value: "2",
              symbol: {
                type: "simple-fill", // autocasts as new SimpleFillSymbol()
                color: avyGridTop[2]
              }
            },
            {
              // All features with value of "Southeast" will be red
              value: "3",
              symbol: {
                type: "simple-fill", // autocasts as new SimpleFillSymbol()
                color: avyGridTop[3]
              }
            },
            {
              // All features with value of "South" will be yellow
              value: "4",
              symbol: {
                type: "simple-fill", // autocasts as new SimpleFillSymbol()
                color: avyGridTop[4]
              }
            }
          ]
        };
        console.log(avyGridTop[0]);
        console.log(avyGridTop);

        console.log(rendererTop);

        const geojsonLayer = new GeoJSONLayer({
          url: url,
          opacity: 0.75,
          copyright: "Mountainlabmaps.com",
          renderer: rendererTop 
        });

        map.add(geojsonLayer);
}
async function asyncCall(){
  await task1(); 
  task2();
};

asyncCall();

});
    </script>
  </head>

  <body>
    <div id="viewDiv">
        <table>
            <thead>
                <tr>
                    <th>Source</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <canvas id="canvas" width="400" height="400"></canvas>
                    </td>
                    <td align="center" class="color-cell" id="hovered-color"></td>
                    <td align="center" class="color-cell" id="selected-color"></td>
                </tr>
            </tbody>
        <table>
       
     
    </canvas></div>
  </body>
</html>