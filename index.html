<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Intro to SceneLayer | Sample | ArcGIS API for JavaScript 4.18</title>
    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
.color-cell {
color: white;
}

    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.18/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.18/"></script>

    <script>
      require(["esri/Map", "esri/views/SceneView", "esri/layers/SceneLayer", "esri/layers/GeoJSONLayer"], function(Map, SceneView, SceneLayer, GeoJSONLayer) {
        // Create Map
        var map = new Map({
          basemap: "topo-vector",
          ground: "world-elevation"
        });

        // Create the SceneView
        var view = new SceneView({
          container: "viewDiv",
          map: map,
          camera: {
            position: [-111.70, 40.313, 30700],
            tilt: 51,
            heading: 0
          }
        });

        const url =
          "http://mountainlabmaps.com/avy/json/SLC_GreaterThan9500.geojson";


const topArray = [
    {x: 198, y: 132},
    {x: 219, y: 138},
    {x: 233, y: 157},
    {x: 225, y: 179},
    {x: 201, y: 187},
    {x: 177, y: 176},
    {x: 163, y: 156},
    {x: 178, y: 138},
];



// Get the CanvasPixelArray from the given coordinates and dimensions.
// var imgd = ImageData.data[((50 * (ImageData.width * 4)) + (200 * 4)) + 2];
// console.log(imgd);
// var pix = imgd.data;


var img = new Image();
//img.crossOrigin = 'anonymous';
img.src = 'https://mountainlabmaps.com/images/avy20210303.png';
var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
img.onload = function() {
  ctx.drawImage(img, 0, 0);
  img.style.display = 'none';
};
var hoveredColor = document.getElementById('hovered-color');
var selectedColor = document.getElementById('selected-color');


// //grab rgb from x,y
// var topNorth = ctx.getImageData(198, 132, 1, 1).topNorth;
// console.log(topNorth);
// var rgbTopNorth = [ topNorth[0], topNorth[1], topNorth[2] ];
// console.log(rgbTopNorth);

// function getPixelXY(imgData, x, y) {
//   return getPixel(imgData, y*imgData.width+x);
// }


function pick(event, destination) {
  var x = event.layerX;
  var y = event.layerY;
  var pixel = ctx.getImageData(x, y, 1, 1);
  var data = pixel.data;


const rgba = `rgba(${data[0]}, ${data[1]}, ${data[2]}, ${data[3] / 255})`;
    const comboText = ["X: " + x + ", Y: " + y + ", " + "rgb: " + rgba];
destination.style.background = rgba;
destination.textContent = rgba;

return rgba;
}

avyGridTop = [];

topArray.forEach(pickArray);



function pickArray(event) {
  var x = event.x;
  var y = event.y;
  var pixel = ctx.getImageData(x, y, 1, 1);
  console.log(x);
  console.log(y);
  var data = pixel.data;
  console.log(data);

  const rgba = [data[0], data[1], data[2]];
// const rgba = `rgba(${data[0]}, ${data[1]}, ${data[2]}, ${data[3] / 255})`;
    //const comboText = "X: " + x + ", Y: " + y + ", " + "rgb: " + rgba;
    const comboText = rgba;
    console.log(comboText);
//destination.style.background = rgba;
//destination.textContent = rgba;
    avyGridTop.push(comboText);
return rgba;
}

    console.log(avyGridTop);
});
   


var rendererTop = {
          type: "unique-value", // autocasts as new UniqueValueRenderer()
          field: "gridcode",
          defaultSymbol: { type: "simple-fill" }, // autocasts as new SimpleFillSymbol()
          uniqueValueInfos: [
            {
              // All features with value of "North" will be blue
              value: "0",
              symbol: {
                type: "simple-fill", // autocasts as new SimpleFillSymbol()
                color: "blue"
              }
            },
            {
              // All features with value of "NorthEast" will be green
              value: "1",
              symbol: {
                type: "simple-fill", // autocasts as new SimpleFillSymbol()
                color: "green"
              }
            },
            {
              // All features with value of "East" will be green
              value: "2",
              symbol: {
                type: "simple-fill", // autocasts as new SimpleFillSymbol()
                color: "green"
              }
            },
            {
              // All features with value of "South" will be red
              value: "4",
              symbol: {
                type: "simple-fill", // autocasts as new SimpleFillSymbol()
                color: "red"
              }
            },
            {
              // All features with value of "West" will be yellow
              value: "6",
              symbol: {
                type: "simple-fill", // autocasts as new SimpleFillSymbol()
                color: "yellow"
              }
            }
          ]
        };

        const geojsonLayer = new GeoJSONLayer({
          url: url,
          opacity: 0.75,
          copyright: "Mountainlabmaps.com",
          renderer: rendererTop 
        });

        map.add(geojsonLayer);







      });
    </script>
  </head>

  <body>
    <div id="viewDiv">
        <table>
            <thead>
                <tr>
                    <th>Source</th>
                    <th width="150">Hovered color</th>
                    <th width="150">Selected color</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <canvas id="canvas" width="400" height="400"></canvas>
                    </td>
                    <td align="center" class="color-cell" id="hovered-color"></td>
                    <td align="center" class="color-cell" id="selected-color"></td>
                </tr>
            </tbody>
        <table>
       
     
    </canvas></div>
  </body>
</html>